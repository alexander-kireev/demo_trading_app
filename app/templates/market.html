{% extends "base.html" %}

{% block title %}Market{% endblock %}

{% block content %}
<div class="container my-5">

  <!-- heading -->
  <div class="row mb-4">
    <div class="col text-center">
      <h2 class="fw-bold text-uppercase text-dark">Market</h2>
      <p class="text-muted">Search for stocks and place trades</p>
    </div>
  </div>

  <!-- flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }} text-center">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="row g-4">

    <!-- stock search -->
    <div class="col-md-5">
      <div class="card shadow-sm">
        <div class="card-header">
          Search Stock
        </div>
        <div class="card-body">
          <form action="/market" method="GET">
            <div class="mb-3">
              <label for="ticker" class="form-label">Enter stock symbol:</label>
              <input type="text" class="form-control" id="ticker" name="ticker" placeholder="e.g. AAPL, TSLA">
            </div>
            <button type="submit" class="btn btn-primary w-100">Search</button>
          </form>
        </div>
      </div>
    </div>

    <!-- stock info + order -->
    <div class="col-md-7">
      <div class="card shadow-sm">
        <div class="card-header">
          Stock Details
        </div>
        <div class="card-body">

          <form action="/place_order" method="POST">

            <!-- symbol -->
            <div class="row mb-3">
              <div class="col-sm-5 fw-bold">Symbol:</div>
              <div class="col-sm-7">{{ stock.symbol|toupper if stock else '-' }}</div>
              <input type="hidden" id="display_stock_symbol" name="display_stock_symbol"
                     value="{{ stock.symbol if stock else '' }}">
            </div>

            <!-- company -->
            <div class="row mb-3">
              <div class="col-sm-5 fw-bold">Company:</div>
              <div class="col-sm-7">{{ stock.company_name|titlecase if stock else '-' }}</div>
              <input type="hidden" id="display_company_name" name="display_company_name"
                     value="{{ stock.company_name if stock else '' }}">
            </div>

            <!-- shares held -->
            <div class="row mb-3">
              <div class="col-sm-5 fw-bold">Shares held:</div>
              <div class="col-sm-7">{{ shares_held if shares_held else 0 }}</div>
              <input type="hidden" id="display_shares_held" name="display_shares_held"
                     value="{{ shares_held }}">
            </div>

            <!-- average cost -->
            <div class="row mb-3">
              <div class="col-sm-5 fw-bold">Avg. cost/share:</div>
              <div class="col-sm-7">
                {{ average_price_per_share|currency if average_price_per_share else '-' }}
              </div>
              <input type="hidden" id="display_average_price_per_share" name="display_average_price_per_share"
                     value="{{ average_price_per_share }}">
            </div>

            <!-- total position -->
            <div class="row mb-3">
              <div class="col-sm-5 fw-bold">Total value:</div>
              <div class="col-sm-7">
                {{ total_position_value|currency if total_position_value else '-' }}
              </div>
              <input type="hidden" id="display_total_position_value" name="display_total_position_value"
                     value="{{ total_position_value }}">
            </div>

            <!-- current price -->
            <div class="row mb-4">
              <div class="col-sm-5 fw-bold">Current price:</div>
              <div class="col-sm-7">
                {{ stock.price|currency if stock else '-' }}
              </div>
              <input type="hidden" id="display_current_price" name="display_current_price"
                     value="{{ stock.price if stock else '' }}">
            </div>

            <!-- order amount -->
            <div class="mb-3">
              <label for="order_amount" class="form-label">Number of shares:</label>
              <input type="number" min="1" max="100000" class="form-control" required id="order_amount" name="order_amount">
            </div>

            <!-- actions -->
            <div class="d-flex justify-content-between">
              <button type="submit" name="action" value="BUY" class="btn btn-buy w-50 me-2">Buy</button>
              <button type="submit" name="action" value="SELL" class="btn btn-sell w-50">Sell</button>
            </div>

          </form>

        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
