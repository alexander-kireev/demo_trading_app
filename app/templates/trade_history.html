{% extends "base.html" %}

{% block title %}Trade History{% endblock %}

{% block content %}

<div class="row text-center">
  <h2>Trade History</h2>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="alert alert-{{ category }}">
        {{ msg }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Date filter form -->
<div class="row my-3">
  <form action="/trade_history" method="GET" class="d-flex justify-content-center">
    <div class="mx-2">
      <label for="start_date">Start date:</label>
      <input type="date" id="start_date" name="start_date" class="form-control" value="{{ request.args.start_date }}">
    </div>
    <div class="mx-2">
      <label for="end_date">End date:</label>
      <input type="date" id="end_date" name="end_date" class="form-control" value="{{ request.args.end_date }}">
    </div>
    <div class="align-self-end mx-2">
      <button type="submit" class="btn btn-primary">Filter</button>
    </div>
  </form>
</div>

<!-- Trade history table -->
<div class="row">
  <div class="col">
    {% if trades %}
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Symbol</th>
            <th>Company</th>
            <th>Shares</th>
            <th>Price per Share</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for trade in trades %}
            <tr>
              <td>{{ trade.timestamp }}</td>
              <td>{{ trade.trade_type }}</td>
              <td>{{ trade.symbol }}</td>
              <td>{{ trade.company_name }}</td>
              <td>{{ trade.number_of_shares }}</td>
              <td>${{ trade.price_per_share }}</td>
              <td>${{ trade.trade_total }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-center mt-4">No trades found for the selected period.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
